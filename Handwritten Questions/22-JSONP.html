<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

</body>

</html>

<script>
  // 创建一个私有作用域
  // 函数内部可以访问到全局的 window 对象和 document 对象，同时又不污染全局命名空间
  (function (window, document) {
    function jsonp(options) {
      let { url, data, callback } = options

      // 1 转化url
      let params = []
      for (let key in data) {
        params.push(key + '=' + data[key])
      }
      url += url.indexOf('?') === -1 ? '?' : '&'
      url += params.join('&')
      console.log('url1', url)

      // 2 处理回调函数
      let cbFuncName = 'jsonp' + Math.random().toString().replace('.', '')
      url += '&callback=' + cbFuncName
      console.log('url2', url)

      // 3 创建script标签
      let scriptEle = document.createElement('script')
      scriptEle.src = url

      // 4 挂载回调函数
      window[cbFuncName] = function (data) {
        console.log('data', data)
        callback(data)
        document.body.removeChild(scriptEle)
      }

      document.body.appendChild(scriptEle)

    }

    window.$jsonp = jsonp
  })(window, document)

  $jsonp({
    // url: 'www.example.com',
    // 用json-server起个服务试试 可以啊
    url: 'http://localhost:3000/comments',
    // data: { id: 1, name: 'ttt' },
    callback: function (res) {
      console.log('res', res)
    }
  })

  // 当然通过这个随便的地址是拿不到东西的，但是可以看出来是发送了请求的
</script>